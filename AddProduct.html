<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Impact AI Onboarding Demo</title>
    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Small utility so our <details> looks nice */
      details[open] summary svg { transform: rotate(180deg); }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-neutral-950 via-neutral-900 to-neutral-950 text-neutral-100 p-6">
    <div id="root"></div>

    <!-- React + ReactDOM + Babel (for JSX in the browser) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- App code (JSX compiled in the browser) -->
    <script type="text/babel">
      const { useState, useMemo } = React;

      const steps = [
        { key: 'Product', label: 'Product' },
        { key: 'Connect', label: 'Connect' },
        { key: 'APIs', label: 'APIs' },
        { key: 'Review', label: 'Review & Test' },
      ];

      const validators = {
        Product: (d) => !!d.productName.trim() && (d.goals.length > 0),
        Connect: (d) => !!d.version.trim(),
        APIs: (d) => !!d.apiBase.trim() && !!d.apiKey.trim(),
        Review: () => true,
      };

      function App(){
        const [activeIdx, setActiveIdx] = useState(0);
        const [touched, setTouched] = useState(false);
        const [data, setData] = useState({
          productName: '', goals: [], version: '', releaseNotes: '', apiBase: '', apiKey: ''
        });

        const activeStep = steps[activeIdx];
        const isValid = validators[activeStep.key](data);
        const completed = useMemo(() => steps.map((s,i)=> i < activeIdx ? true : i===activeIdx ? (isValid && touched) : false), [activeIdx, isValid, touched]);

        const handleNext = () => {
          setTouched(true);
          if(!validators[activeStep.key](data)) return;
          if(activeIdx < steps.length - 1) setActiveIdx(i=>i+1);
        };
        const handleBack = () => setActiveIdx(i=> Math.max(0, i-1));

        return (
          <div className="mx-auto w-full max-w-5xl grid md:grid-cols-[280px_1fr] gap-6">
            <aside className="bg-neutral-900 rounded-2xl shadow-lg border border-neutral-800 p-4">
              <h2 className="text-lg font-semibold mb-3">Add Product</h2>
              <div className="mb-3 rounded-xl p-3 bg-gradient-to-r from-violet-600 to-teal-500 text-white">
                <div className="text-xs tracking-wide uppercase opacity-90">Impact AI</div>
                <div className="font-semibold">Onboarding</div>
              </div>
              <nav className="space-y-1">
                {steps.map((s,i)=>{
                  const isActive = i===activeIdx;
                  const isDone = completed[i];
                  return (
                    <button key={s.key} onClick={()=>setActiveIdx(i)}
                      className={[
                        'w-full flex items-center gap-3 rounded-xl px-3 py-2.5 text-left transition border border-transparent',
                        isActive ? 'bg-indigo-950/60 border-indigo-800' : 'hover:bg-neutral-800'
                      ].join(' ')}>
                      <div className={[
                        'w-7 h-7 rounded-full flex items-center justify-center border',
                        isDone ? 'bg-violet-600 text-white border-violet-600' : isActive ? 'bg-teal-600 text-white border-teal-600' : 'bg-neutral-800 text-neutral-400 border-neutral-700'
                      ].join(' ')}>{isDone ? '✓' : i+1}</div>
                      <div className="flex-1">
                        <div className="text-sm font-medium text-neutral-100">{s.label}</div>
                        <div className="text-xs text-neutral-500">Step {i+1} of {steps.length}</div>
                      </div>
                    </button>
                  )
                })}
              </nav>
            </aside>

            <section className="flex flex-col min-h-[560px]">
              <div className="bg-neutral-900 rounded-2xl shadow-lg border border-neutral-800 p-6 flex-1">
                <StepContent stepKey={activeStep.key} data={data} setData={setData} />
              </div>
              <div className="mt-4 bg-neutral-900 rounded-2xl shadow-lg border border-neutral-800 p-4 flex items-center justify-between">
                <div className="text-xs text-neutral-500">Progress: Step {activeIdx+1} of {steps.length}</div>
                <div className="flex gap-2">
                  {activeIdx > 0 && (
                    <button onClick={handleBack} className="px-3 py-2 rounded-xl border text-sm hover:bg-neutral-800 border-neutral-700 flex items-center gap-1">‹ Back</button>
                  )}
                  {activeIdx !== steps.length - 1 && (
                    <button onClick={()=>alert('Draft saved (mock)')} className="px-3 py-2 rounded-xl border text-sm hover:bg-neutral-800 border-neutral-700">Save Draft</button>
                  )}
                  <button onClick={handleNext}
                    className={[
                      'px-4 py-2 rounded-xl text-sm text-white flex items-center gap-1',
                      isValid ? 'bg-violet-600 hover:bg-violet-700' : 'bg-violet-900/50 cursor-not-allowed'
                    ].join(' ')}>
                    {activeIdx === steps.length - 1 ? 'Finish' : 'Continue'} ›
                  </button>
                </div>
              </div>
            </section>
          </div>
        );
      }

      function StepContent({ stepKey, data, setData }){
        const [input, setInput] = useState('');
        const addGoal = () => { const v=input.trim(); if(!v) return; setData(d=>({...d, goals:[...d.goals, v]})); setInput(''); };
        const removeGoal = (i) => setData(d=>({...d, goals: d.goals.filter((_,idx)=>idx!==i)}));

        if(stepKey === 'Product'){
          return (
            <div className="space-y-6">
              <Header title="Add your Product" subtitle="Add the name and goals of your product so we can connect it to the platform, organize versions, keys and traces." />
              <Field label="Product name" required>
                <input className="w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-500 bg-neutral-950 text-white" placeholder="e.g., Telus Virtual Assistant" value={data.productName} onChange={(e)=> setData(d=>({...d, productName:e.target.value}))} />
              </Field>
              <Field label="Goals" required>
                <div className="flex flex-wrap gap-2 mb-2">
                  {data.goals.map((g,i)=> (
                    <span key={i} className="px-2 py-1 rounded-full bg-neutral-800 border border-neutral-700 text-xs text-neutral-300">
                      {g}
                      <button className="ml-2 text-neutral-500 hover:text-neutral-300" onClick={()=>removeGoal(i)} aria-label={`Remove ${g}`} type="button">×</button>
                    </span>
                  ))}
                </div>
                <div className="flex items-center gap-2">
                  <input className="flex-1 border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-500 bg-neutral-950 text-white" placeholder="Add a goal and press Enter" value={input} onChange={(e)=>setInput(e.target.value)} onKeyDown={(e)=>{ if(e.key==='Enter'){ e.preventDefault(); addGoal(); } }} />
                  <button onClick={addGoal} type="button" className="px-3 py-2 rounded-xl border text-sm hover:bg-neutral-800 border-neutral-700">Add</button>
                </div>
              </Field>
            </div>
          );
        }

        if(stepKey === 'Connect'){
          const sdkSnippet = `from impact.sdk import Impact\n\n# Initialization\nImpact.init()\n\n# Optional: annotate workflows\nfrom impact.sdk.decorators import workflow\n\n@workflow(name="agent_workflow")\ndef execute_agent():\n    # Your agent workflow here\n    return result\n\n# Environment variables required\n# IMPACT_API_KEY\n# IMPACT_URL`;
          const copy = () => { navigator.clipboard.writeText(sdkSnippet).then(()=>alert('Code copied!')); };
          return (
            <div className="space-y-6">
              <Header title="Connect" subtitle="Provide the version you want to connect and optional release notes. In order to see traces flow on Impact AI, a small manual code edit is necessary. The following are instructions on how to connect the SDK. Remember you can also do this connection later." />
              <Field label="Version" required>
                <input className="w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-500 bg-neutral-950 text-white" placeholder="e.g., v1.0.0" value={data.version} onChange={(e)=> setData(d=>({...d, version:e.target.value}))} />
              </Field>
              <Field label="Release notes (optional)">
                <textarea rows="5" className="w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-500 bg-neutral-950 text-white" placeholder="Summary of changes…" value={data.releaseNotes} onChange={(e)=> setData(d=>({...d, releaseNotes:e.target.value}))}></textarea>
              </Field>
              <details className="rounded-xl bg-neutral-800 border border-neutral-700 p-3 text-sm text-neutral-200">
                <summary className="cursor-pointer font-medium text-teal-400 flex items-center gap-2">SDK Connection Instructions <svg class="w-3 h-3 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"/></svg></summary>
                <p className="mt-2 text-neutral-300 text-xs">Follow these steps in your codebase (can be done later):</p>
                <pre className="mt-2 text-xs text-neutral-300 whitespace-pre-wrap">{sdkSnippet}</pre>
                <button onClick={copy} className="mt-2 px-3 py-1 rounded-lg bg-violet-600 text-white text-xs hover:bg-violet-700">Copy code</button>
              </details>
            </div>
          );
        }

        if(stepKey === 'APIs'){
          return (
            <div className="space-y-6">
              <Header title="Connect APIs" subtitle="Provide API details so Impact AI can send prompts and receive responses." />
              <Field label="API base URL" required>
                <input className="w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-500 bg-neutral-950 text-white" placeholder="https://api.your-product.com/v1" value={data.apiBase} onChange={(e)=> setData(d=>({...d, apiBase:e.target.value}))} />
              </Field>
              <Field label="API key" required>
                <input className="w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-violet-500 bg-neutral-950 text-white" placeholder="Paste your key" value={data.apiKey} onChange={(e)=> setData(d=>({...d, apiKey:e.target.value}))} />
              </Field>
            </div>
          );
        }

        if(stepKey === 'Review'){
          const maskedKey = data.apiKey ? data.apiKey.replace(/.(?=.{4})/g, '•') : '';
          return (
            <div className="space-y-6">
              <Header title="Review & Test" subtitle="Confirm details, then run quick checks." />
              <div className="grid md:grid-cols-2 gap-4">
                <div className="rounded-2xl border border-neutral-800 p-4 bg-neutral-950">
                  <h4 className="font-medium mb-2 text-white">Product</h4>
                  <ul className="text-sm text-neutral-300 space-y-1">
                    <li><strong>Name:</strong> {data.productName || <em className="text-neutral-600">(not set)</em>}</li>
                    <li><strong>Goals:</strong> {data.goals.length ? data.goals.join(', ') : <em className="text-neutral-600">(none)</em>}</li>
                    <li><strong>Version:</strong> {data.version || <em className="text-neutral-600">(not set)</em>}</li>
                  </ul>
                </div>
                <div className="rounded-2xl border border-neutral-800 p-4 bg-neutral-950">
                  <h4 className="font-medium mb-2 text-white">APIs</h4>
                  <ul className="text-sm text-neutral-300 space-y-1">
                    <li><strong>Base URL:</strong> {data.apiBase || <em className="text-neutral-600">(not set)</em>}</li>
                    <li><strong>Key:</strong> {maskedKey || <em className="text-neutral-600">(not set)</em>}</li>
                  </ul>
                </div>
              </div>
              <div className="rounded-2xl border border-neutral-800 p-4 bg-neutral-950 space-y-4">
                <div>
                  <div className="mb-2 font-medium text-white">Quick smoke test</div>
                  <button onClick={()=>alert('Running smoke test… (mock)')} className="px-4 py-2 rounded-xl bg-teal-600 text-white text-sm hover:bg-teal-700">Run smoke test</button>
                </div>
                <div>
                  <div className="mb-2 font-medium text-white">Traces check</div>
                  <button onClick={()=>alert('Verifying traces… (mock)')} className="px-4 py-2 rounded-xl bg-violet-600 text-white text-sm hover:bg-violet-700">Verify traces</button>
                </div>
              </div>
            </div>
          );
        }

        return null;
      }

      function Header({ title, subtitle }){
        return (
          <div>
            <h3 className="text-xl font-semibold mb-1 text-white">{title}</h3>
            <p className="text-sm text-neutral-400">{subtitle}</p>
          </div>
        );
      }

      function Field({ label, children, required }){
        return (
          <label className="block">
            <div className="mb-1 text-sm font-medium text-neutral-200">{label} {required && <span className="text-rose-500">*</span>}</div>
            {children}
          </label>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App/>);
    </script>
  </body>
</html>
